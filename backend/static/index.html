<!DOCTYPE html>
<html>
<head>
    <title>PDF Chat Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .message { margin: 10px; padding: 10px; border-radius: 8px; max-width: 80%; }
        .user { background: #dcf8c6; margin-left: auto; }
        .bot { background: #f1f0f0; }
    </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col">
    <div class="bg-blue-600 p-4 text-white font-bold flex justify-between">
        <span>PDF AI Assistant</span>
        <input type="file" id="pdfInput" onchange="uploadFile()" class="text-sm">
    </div>

    <div id="chat" class="flex-1 overflow-y-auto p-4 space-y-4">
        <div class="message bot">Hello! Upload a PDF to start.</div>
    </div>

    <div class="p-4 bg-white flex gap-2">
        <input id="queryInput" type="text" class="flex-1 border p-2 rounded" placeholder="Type a message...">
        <button onclick="sendQuery()" class="bg-blue-600 text-white px-4 py-2 rounded">Send</button>
    </div>

    <script>
        async function uploadFile() {
            const file = document.getElementById('pdfInput').files[0];
            const formData = new FormData();
            formData.append('file', file);

            addMessage('bot', 'Processing PDF...');
            const res = await fetch('/upload-pdf', { method: 'POST', body: formData });
            const data = await res.json();
            addMessage('bot', data.message || 'Done!');
        }

        async function sendQuery() {
            const input = document.getElementById('queryInput');
            const text = input.value;
            if (!text) return;

            addMessage('user', text);
            input.value = '';

            // This matches your Question(BaseModel) with "query" field
            const res = await fetch('/ask', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ query: text }) 
            });
            const data = await res.json();
            addMessage('bot', data.answer || data.error);
        }

        function addMessage(role, text) {
            const div = document.createElement('div');
            div.className = `message ${role}`;
            div.innerText = text;
            document.getElementById('chat').appendChild(div);
        }
    </script>
</body>
</html>